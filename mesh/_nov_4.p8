pico-8 cartridge // http://www.pico-8.com
version 27
__lua__

poke(0x5f5f, 0x10)

---bits is a 8-bit field
function palmix(bits, region, length)
	if bits==nil then
		memset(0x5f70, 0, 16)
	else
		memset(0x5f70 + region, bits, length)
	end
end

function pow2(n)
	local r = 1
	for i=1,n do
		r*=2
	end
	return r
end

█=1000
dt=0.0333
t=0

pal({1+128,
	1,
	3+128,
	3,
	11+128,
	11,
	10+128,
	10,
	7+128,
	7,
},1)

pal({
	1+128,
	1+128,
	1+128,
	1,
	3+128,
	3,
	11+128,
	11,
	10+128,
	10,
},2)

function sqr(a) return a*a end
function dist(x1,y1,x2,y2) return sqrt(sqr(x2-x1)+sqr(y2-y1)) end

cls(1)

local bb = 0

::♥::
--cls()
t+=dt

if (rnd(1)<0.1) bb += pow2(rnd(16))
palmix(bb, 0, 16)

for i=1,100 do
	x,y=rnd(128),rnd(128)
	circ(x,y,1,max(1,pget(x,y)-1))
end

memcpy(0x6000+rnd(0x1fa0)-100,0x6000+rnd(0x1fff),128)

rectfill(64-8,0,64+8,128,1)

do
	x=sin(t/8)*16+64
	y=-t*32
	y=y%128
	c=t%8*8%17%10+1
	circfill(x,y,sin(t/4)*4+6,c)
	circfill(64-(x-64),(y+64)%128,sin(t/8)*4+6,c)
end

k=64
j=17+sin(t/4)
for xa=-k-sin(t/3)*8,128+k,j do
	for ya=-2*k,128+2*k,j do
		x,y=xa+cos(t/6)*8,ya+sin(t/8)*16
	
		h=8*(sin(cos(y/256-t/200)+1)+1)
			+4*(sin(x/128-t)+1)
		
		x2,y2=xa+j,ya
		x2,y2=x2+cos(t/6)*8,y2+sin(t/8)*16
		h2=2*(sin(sin(y2/256-t/8)-t)+1)
		
		--line(x,y-h-1,x2,y2-h2-1,5)

		line(x,y-h,x2,y2-h2,(t*2+x/16+y/16)%10+1)
		line(x,y-h+1,x2,y2-h2+1,4)
		
	end
end

if rnd(1)<0.005 then cls(1) end

flip()goto ♥
__gfx__
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
