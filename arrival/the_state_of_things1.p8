pico-8 cartridge // http://www.pico-8.com
version 27
__lua__
--the state of things
--by ???

-- round down a to the nearest multiple of unit
function fflr(a, unit)
	return a - a%unit
end

-- palette defined in pairs.
pal({
	[0]=0,7,--black/white (0 omitted)
	2,8+128,
	13+128,13,--lavender
	1,12+128,--blue
	3+128,3,--green
	135,142,--yellow/orange
	8+128,8,--red
	6,7,--white/gray
},1)

t=-1

-- time it takes for the rectangle's movement to repeat.
-- note that at t=k*period/2 (for all int k), the rectangle has area=0
period=4

cls()
::♥::  -- label. goto(♥) takes us back here.
t+=1/60

--cache some shitty trig (which all trig is)
ct4,st2=cos(t/period),sin(t/(period/2))
st16=sin(t/16)
st8=sin(t/8)

-- sampling rate proportional-ish to area of rectangle.
smpl=1200*abs(ct4)
for i=1,smpl do
	xo=rnd(80) - 64 -- [-64,16]
	yo=rnd(150) - 75 -- [-75,75]
	-- distribution of xo,yo is a uniform rectangle.

	x=(xo+32)*st2 - yo*ct4
	y=(xo+32)*ct4 + yo*st2
	-- rotate & scale x,y

	c = -st8 * x/16
	  + cos(x/64 - t/2) * y/32
	  + (xo/32 + yo/32 + y)/(st16*4+12)
	  + t
	
	c = flr(c%2) -- map c to 0 or 1

	-- the color will change each time the rectangle's area=0
	c += fflr(t+1,period/2)
	
	-- draw, adjust center to (64,64)
	circ(x+64,y+64,1,c)
end

-- draw a lil circle to the point where xo,yo=0,0
-- (this traces out the path of the rectangle)
circfill(32*st2+64,32*ct4+64,2,t*16%15+1)

flip() goto ♥
__label__
07070000070077777770000000700007770707007770000000000000007707000000777777777777777770007777777777000700077777070700000777777770
07700000000007777777070000070777777070777770000000000700077777070000707707777777777707000777777770700000077770700000007077777700
77700000000000770770700007007777700007777700000000000000007777700000000777777770707070000700077707770000707777770000070000077000
77770000000000007007070070077777000077777770000000000000000777770000000777777777070000007000007777770007007707770007000000000000
77707700000000000000000707777707007777777700000000000000007077777700000077777770000000700000077777770007070070700000000000000000
07777770000000000000070077777070070770700000000000000000070700777770000777770707000070007000777077777000000707070700000000000000
70777777700000000000000777707000707777000000000000000000000007077777070077707070700000070007770707777770000077707070000000000000
07777777070000000070700007770000000777700000000000000000700070700777700007770007000000000000007070777707000007777770007700000007
77777777770700000700000777770000000777770000000000000000700007077777077077770070000000000000000707077777770070707777777770000000
07777777777000007070707777770000007777707000000000077770070000707777777707000707000000070000000070777777707700007777777777700000
07707777777770070777070770000000077777070000700707777777000000077777777070700070000000000070000007777777070070000777777077770777
70070777777777777777777770000770777070700000077077777777000000777707777707777000000000000000000000077777707000000777770777707777
00007777777777777777777777000077070000000007007707777770000000077070777770700700000000000000000000007777770000007077777777777777
00070707777777777770777770000007777007000070777770777777700000077707077777000000000000000000000000070777777000070707707777777777
00707070777777777777777070700077777070700007777777077777770700007770777777000000000000000000000000700000770000007070070777777777
00000007777777777777770707000077770707000007777777077777707070000000777777007000000000000000000000000000077077070700000777777777
70000007777777777777770070070777777070000070777777777707700700000000077777777700000000007007000000000000077777777000007077777777
77000000070777777777777000000077770700000007777777777777770000007000777777777770000000770770700000000000700777777700000707777777
77000000007007077700770000000077777700000077777777777777770000000007007777777777000007777777777070000000007077777700000007700770
70000000000000707000000000770777777070000077777777777777770007000070000777777777700000777770770707000007007777077077000000000000
07700000000000000000070077777777777007000007777777777777770077770000000077777777070007777777077770000000000777777770700000000700
77000000000000000000000707777777070000777077777777777777707777707000000007000770770077777777707770070000000077777707000000000000
70700000000000000000007077777777700007077777777777777777770777070700000070000077777777777777770707707000000707777770000000000000
77777000000007000000070777707777700000707777777777777777777007707000000707000077007077777777777070777700000077770777070000007000
77777700000000000000000770777777000007070777777777777777777770777770000070700700000777777777777777777770700700707077707000070770
77777777007000007000707077077707000070707777777777777777777707777770000007070000000077777777777777777707070007000777777007707707
77777777770700007707000777700070700077777777777777777777777070777777000000000000000000777777707777777770777070000777777777770777
07777777777770000770777777700007000777777777777777777077777777070000070000000000000000077777777777777777777700000007777707707777
77777777777777007777777777070700777077777777777777000007777777707007707000000000000000777777777777777777777000000000770777077777
77777777777777777707777070700000700007777077707070000007070777077770070000000000000000077777777777777777777700000000707077777777
77077777777777770777770707700000070007777770000000000000707077777777077000000000070000777777777777777777777000000000070777077777
00707777777777777077707077070700007077777777000000000000070777777770777700770000707777777777770777777777770707000000000070000777
00007077777777770707070700707070777777777770700000000000007770777707777777777000777777777700700077770777777070700000700700007777
00000007777777777700707070070000077770777007000000000000000777077077077777777007777777777070000000707007777707777000000000070070
00000000707777777777070700000000777700777700000000000700000077700077777777777777777777770700000007070070777777770707000000000000
00000000000770777770700070070007777707077000000000000070000000070707777777777777777777777070000000700007077777777077700000000000
00000000000007007700000000707077777770700000000000000000000000007077777777777777777777777700000007000000707777777777700000000000
00000000000000000000000070000777777700000000000000000000070000000777777777777777777777777000000000000007077077777777770700000000
00000000000000000000000007070777777700000000000000000000000000077777077777777777777777070000000000000000000707777777777070700000
00000000000000000000070077707777777070000000000000000000000000000070707777777777770770000000000000000000000007077777777707777000
70700000000000000000000777777777770700000000000000000000000000000000007077707700007070000000000070000000000000777777777777777777
77000000000700000000000077777770700070000000000000000000000000000000070700000000000000000000007777000000000000777777777777777777
77700070000007000007000777777777000000000000000000000000000000000000007000000000070000000000077777707000000000007777777777777777
77777707000070777070777777777777700000000000000000000077000000000000007007000000000000000000077777777700000000000077777777777777
77777777770707777777777077777777700000000000000007007777700000000000000000000000000000000000777777777777700700000700777777777777
77777777777777777777777777707777000000000000000770777077000707000000000000000000000000000070777777777777777070000000070707777777
77777777777777777777077777070700000000000000070777770777707070707000000000000000000000000777777777777777770700000000007070770777
77777777777777777777777777777070000000000070777777077777707707070700000000000000000000007777777777770777770000000700070700700007
77777777777777777777777707707700000000007077777777777777770770777007000700000070070000777777777777777000770700070000007000000070
77777777777777777777777070770000000000000777777777777777777777777777707070007707707077777777777777700000077077707000700000000700
77777777777777777707070707000000000007070777777777777777777777777777770707077770077777777777777077070000777777770777070000000000
77077777777777707070000000000000000077707777777777777777777777707777777770777707777777777777770707000000007777777777707000000000
70000700777707000700000000000000000007777777777777777777777777077777777777777777777777777777707000000000000707707777770070000000
00000000007000000000000000000000000077777777777777777777777777777777777777777777777777777770700000000000000070777777777707700000
00000000000000000000000000000000007077777777777777777777777777777777777777777777777777770707000000007000007000007770770077770000
00000000000000000000000000000007070777777777777777777777777777777777777777777777777777777000000000000000070000000077777777777007
00000000000000000000000000000000777777777777777777777777777777777777777777777770007777700070000000000000007000000700777777770777
00000000000000000000000000070007777777777777777777777777777777777777777777700700000000000000000000000070000000000000077777777777
00700000000000000000070070777777777777777777777777777777777777777700777707000000000000000000000000000007000000000000077777777777
00000000000000070000707707777777777777777777777777777777770007007000000000000000000000000000000000000070700000000000007007007777
00000700000000707070077777777777777777777777777777077700700000007000070000000000000000700000000000000077000000007070000000000777
00700700000777777707777777777777777777777777777770007000070000000700707000000000000000000007000000000707700077770700000007000077
77007070000777777777777777777777777777777777007700000000000000000000000000000000000000000070700007077077077777777070000007000077
77777707707777777777777777777777777777777777700000000000000000000000000000000000000000000007700070707700777777777707000000000000
77777777777777777777777777777777777777777777000000000000000000000000000000000000000007070007077707077077777777777070070000000000
77777777777777777777777777777707777770000770000000000000000000000000000000000000000770707770777770777707777777777777707000000000
77777777777777777777777777777077070000000000000000000000000000000000000070700070707077777777077777777777777777777777077007700000
77777777777777777777770707070700000000000000000000000000000000000000000707070007770777777777777707777777777777777777777777777070
70777770077700707070000070007000000000000000000000000000000000000000000777700707777777777777777777777777777777777777777777777777
70077700007000070700000000000000000000000000000000000000000000007000777777777777777777777777777770777777777777770777777777777777
07007007770700000000000000000000000000000000000000000000000000070770777777777777777777777777777777077777777707777777077777777777
70770777777000000000000000000000000000000000000000000000000007707777777777777777777777777777077707077777770070770777777777777777
77707077700000000000000000000000000000000000000000000000000777777777777777777777777777777770707070707077707007707077770777777700
07070700000000000000000000000000000000000000000000000000007777777777777777777777777777777777077707000700700777700700007077777070
70000000000000000000000000000000000000000000000000000000777777777777777777770000077077770007770770070007000777000000000707070700
00000000000000000000070000000000000000000000000000000000077777777777777777700000000007000000007007000700000007700000007770707000
00000000000000070000777007000000000000000000000000000700777777777777777777000000000000000000000000707000000007000007070007000000
00000000000000777007777770700000070000000000000000007777777777777777777770000000000000000070000000070700000070700070700000000000
70007070000707777707777777770700707070700000000000007777777777777777770700000000000007000000000000707070007007000000070000000000
00070707070077777777777777777777070777700000000000077777777777777707000000000000000000000070000000000007000700000000000000000000
00007077707777777777777777777770777777770070007707777777777777777700000000000000000000000707000000000000000000000770000000000000
00070777777777777777777777777777nnn777707777777777777777777777777070000000000000070000070077770000000000007000000007000000000007
7777777777777777777777777777777nnnnn07077777777777777777777770700700000000000007777700707777777000000000000000000000700000000770
777777777777777777777777777777nnnnnn70777777777777777777777707000000000000070077777777077077770077000000000700000000000000077077
7777777707777777707777770777777nnnnn77777777777777777777777770000000000000707777777770700770700000700000000000000000000707777707
707777777707070700070700007777n7nnn777777777777777777777777700000000000707777777707777077777707707000000000000000000077777777077
070777777070707000000000000777377n7777777777777777777777707000000000007077777777777777777777777777770007700000700000707777777777
00007777000700000000000000007773733777777777777777777777770000000000070777777777707777777777777777707000777007070007070777777777
000000700000000000000000000070j7337777777777777777777777770000000000777777777777777777777777777777770007777000707070707777770777
000070000000000000000000000000000707s7777777777777777777700000000007777777777777777777777777777707777070770000077007007777777777
07070000000000000000000000000000007077777777777777777777000000000000777777777770707777077077777777777707000007777700077777777777
70777000000000000000000000000070000s77777777777777777770000000000007777777777707070070700707777777777070070770777700777777777777
777777770007000007000000000000000s0077777777777777777707000000000777777777777770000007077070707777777707707777077007777777777700
77777777707700007770700000000000000707077777777777777070000000000777777777700700000070700707000777770077770770070007777777770070
77777777777770777777770000000000707000707777777777770000000000707777777700000700000000070070000777700777770770777777777777700007
77777777777777777777770007000000000000070777777777770000000070777777770000000000000000000000000077777777707777777777777777700000
70777777777777777777777770700000000000007007707770070000000707077777770000000000000700000000000077770777077777777777777777000000
07077777777777777777777777077700000000000000000700000000000070777777700000000000007007007000000007707077707777777777777777000000
70007777777777777777777777777770070000000000007000000000000770777777000000000000070070770700000000007070777077077777777770700000
00000070777777777777777777777707000000000000070000000000000707077770000000007000777707077700000000000700770770777777777707000000
00000007707777777777777777777777700070000000000000000000000770777707000000070707077777777070700000007007070707777777777700000007
00000000070077777707777770777777707707000000000000000000000077777770000000007770077777770707777007000770077077777777777000000077
00000000000007777070777707077777770770000000000000070000000777777700000000777777777770770077770700000070007777770777700000000007
00000000070007777707770770777777777777000000000000000000777777777770000000777770777777777777700000000000000777707077000000000077
00000000000007777777700077077777777777000000000000000000777777077700000770777777077777777777770700070700000077770777700000000777
00000000000077777770000000707777777777700000000000000000777777700000000777777777777707777777777070700000000070707777700000000077
00070000000007777777000077077777077777770000000000000007077777000000000777777777777070707770770700007000000707070770770000007777
77777000000077777777707007770070777777700000000000000000777777000000707770777777770700070777007007000000007000707007000000077777
77777770000007707777770077700007777777770000000000000007777777000077777777777777777700000777777770707000070070770000000000077777
77777707000007077777770007700000077777700000000000000077777770000007777777777777070070007077777777770700000007770000000000777777
77777070000000700777777000000000000777000000000000070777777770000007777777070700000000000777707777707000000077000000000007777777
77777707770000000077777000000000000077770770000000077777777770000077777770707000000000000000000707777700070770000000000007777777
77777777777000000777770700000007070777777777000000777777707700000777777707000000000000000000000777777707700007000000000007777777
77777777770000000077777777000000007777777770700007077777777770007077777700000000000000007000707077777777770000070000000007777777
07777777770000000077777770000000000777770777007000777777777770700777707000000000070700070700070700777077777000007000000077777770
00007777777700070777777707000000007777777777077777777777770700077777700700000000707000007000000077770707770000070000000077777707
00070777777770007777777777700000007777777777777777777777777000007777700000000007070070777000070707707777700000000000000077777070
00007077707700000777777777070000007777777777077777777777770000000777700000000070770007777700700070777077770000000000007777777000
00000007770000000077777777707707007077777777777777777777700000000777770000000777070077777077000007007770777700000000077777770000
00000000777000000077777777777770000007777777777777777777770000000777700000077777777077777777700070000700077000000000077777770000
00000000777700000007777777777777000007777777777777777777770007007070000000777777777777777707000007700700000000000000777777770000
00000000777770000000777777777777700007777777777777777777777070770707070707777777777077770070700070007007000070000000077777700000
00000070077707000000077777777777700007707777777777777070777707777070777777777777770777707007700000000077700777007007777777070007
07070000707070000070077707777777070070000777777777770770000777770707700777777777770070070777770000007777700777770777777777700007
00700007077777000700077777777077707700000077777777077777000777777007000077777777770000007777777000770077077077077007777777000000
07070000777777700000007777777707777000000707777777777777000777777070000777777770700000070777777770770007770777700007777770000000
77777000077777770000077777777777777000007077777777777070000070770700707777700777070070007707777777707077707777000007777777000007
07700700007777700707777777777777770700000777777777770000000707707000077777700000007700707070777700000777070770700077777770000070

