pico-8 cartridge // http://www.pico-8.com
version 29
__lua__
-- basic template

#include maths.lua
#include poly.lua
#include vec.lua
#include subpixel.lua

palettes={
	{
		3+128,
		1+128,
		1,
		12+128,
		12,
		7,
	},{
		1+128,
		1,
		3+128,
		3,
		11+128,
		11,
		10+128,
		10,
		7+128,
		7,
	},{
		3+128,
		1+128,
		1,
		2+128,
		8+128,
		8,
		14+128,
		15+128,
		15,
		7,
	},{
		0,
		0,
		7,
		7,
	},{
		2+128,
		2,
		8+128,
		8,
		9+128,
		9,
		10,
		7+128,
		7,
	},{
		0+128,
		2+128,
		13+128,
		5,
		6+128,
		6,
		7,
	}
}

function _init()
	t=0

	poke(0x5f2e,1)

	cls()
	pal(palettes[6],1)
end

function _update()
	--cls()
	t+=1/30

	if t%4>2 then
		fillp(0b1111000011110000.1)
		circfill(64,64,rnd(48),0)
		fillp()
	end

	for i=1,300 do
		local ang1,r1 = rnd(1),64
		local x1,y1 = r1*cos(ang1)+64,r1*sin(ang1)+64

		
		pset(x1,y1,mid(0,7,pget(x1,y1)+1))
	end
	
	fillp(0b1010010110100101.1)
	for i=1,300 do
		local ang1,r1 = rnd(1),sqrt(rnd(68*68))
		local x,y = r1*cos(ang1)+64,r1*sin(ang1)+64
		local c = boxblur(x,y,1)
		circ(x,y,1,c)
	end
	fillp()

	for i=1,500 do
		local ang1,r1 = rnd(1),64+(rnd(5*5))
		local ang2,r2 = ang1, r1 + 1.2
		local x1,y1 = r1*cos(ang1)+64,r1*sin(ang1)+64
		local x2,y2 = r2*cos(ang2)+64,r2*sin(ang2)+64

		circ(x2,y2,1,
			mid(0,7,pget(x1,y1) + (rnd(1)<0.5 and -1 or 0) )
		)
	end

	s = 64
	si = 16+15.99*sin(t/8)
	sii = s - si

	local ps = {}
	if si==0 then
		ps = {
			vec(0,0),
			vec(s,0),
			vec(s,s),
			vec(0,s),
		}
	else
		ps = {
			{
				vec(si,0),
				vec(sii,0),
				vec(sii,si),
				vec(si,si),
			},
			{
				vec(sii,si),
				vec(s,si),
				vec(s,sii),
				vec(sii,sii),
			},
			{
				vec(si,sii),
				vec(sii,sii),
				vec(sii,s),
				vec(si,s),
			},
			{
				vec(0,si),
				vec(si,si),
				vec(si,sii),
				vec(0,sii),
			},
			{
				vec(si,si),
				vec(sii,si),
				vec(sii,sii),
				vec(si,sii),
			}
		}
	end
	for p in all(ps) do
		foreach(p, function(v)
			v:set(v - vec(s/2,s/2))
		end)
	end

	local rot_ps = rotate_ps(ps, vec(
		0,
		0,
		-t/8
	))

	fillp(0b1010010110100101.1)
	foreach(rot_ps, function(p) 
		polyv(p, vec(64,64), 7)
		if rnd(1)<0.003 then
			polyf(p, vec(64,64), 7)
		end
	end)
	fillp()
end

function rotate_ps(ps, angs)
	local ux,uy,uz = vec.u_rot_yxz(angs)

	local rot_ps = {}
	for ty=1,#ps do
		local row = ps[ty]
		rot_ps[ty] = {}
		for tx=1,#ps[1] do
			local v = ps[ty][tx]

			w = ux*v.x + uy*v.y + uz*v.z

			rot_ps[ty][tx] = w
		end
	end

	return rot_ps
end

function boxblur(x,y,width)
	sum=0
	count=(width*2+1)*(width*2+1)

	for xa=x-width,x+width,1 do
		for ya=y-width,y+width,1 do
			sum=sum+pget(xa,ya)
		end
	end

	return sum/count
end
__label__
00000000000000000tttttgi00ggmmttt5mmmi5m0060t7766t6g7i7i7i77757i75777777757760676777mm5m5t5m5mt5g0iti00ig00000000000000000000ig0
000000000000000000tit5ttiigmmmmt56mmmim66606i5777767i0i0i0i0i0g0i0i00000i0i77777m77777m565t5mt5g5itit0itig550i000000000000g00g0g
000000000000000000itittgigggmmt5t6mmmm7m6m6577777i0i0i0i000i000t0i0000000i0g000577777m765t5t6miggtit0ttit555i0i0i00000000g0g00g0
0000000000000000000ii0giggggtiit6m6mm7m7m7m7i0i0i0i0i00000000000000000000000000000m7m77765t6mig0gm5mttttttg0gigt000000000gg00000
000000000000000000iiiiigi5mti6i6667m66777m0i0i0i0000000000000000000000000000000000000g7t7676igig0mm5t5tttgtgig0050000000g0g00000
0000000000000000000iiiiiim5mmit66666777750g0i000000000000000000000000000000000000000g0i0i7776igmmmmm5m55ttgit0005t000g0ggg0000g0
00000000000000005000giiittmm777t66777t050g0000000000000000000000000000000000000000000g0i0g077mt6mm5t5555mtig0500t0t0giiiit000gig
0000000000000005m5000giit55777776770t000g0000000000000000000000000000000000000000000000000g0g7m76565t55m5igig0i50t0i0giitit0iig0
000000000m0000005mm0ggitit5m77777i000000000000000000000000000000000000000000000000000000000g0tt576565mmmmtigtiti0000gi005t0iii00
0000000mi0m0000g06mmgigitmm5m777g0g000000000000000000000000000000000000000000000000000000000g0i0i766m6mmmmt5tt5g00gii00000g0i000
00g000migi0050006m6migitm5mm77000g0000000000000000000000000000000000000000000000000000000000000i0g766m767m5t55m5g0igi00000000000
0t0g0t0gigi5500006mm5mt6tm775000000000000000000000000000000000000000000000000000000000000000000000576767m765tm5tm00i5gg0g0000000
t0t0itggggi550500mm5m57t67750000000000000000000000000000000000000000000000000000000000000000000000050776767m5mtmttt5050g0000g000
0ttititgtgim5505m0mm765777g000000000000000000000000000000000000000000000000000000000000000000000000000776777mm5tttt050g0g00g0g00
000tititgtm5m5555mm7m7777g0g000000000000000000000000000000000000000000000000000000000000000000000000000m7777m5m55t5t0ggg00g0g000
00t00ittttit5m5i55mm7770g0g00000000000000000000000000000000000000000000000000000000000000000000000000000m777mm55iit5ti0t0tggi000
0t00050t5it5tmi55mmm7m0i0g0000000000000000000000000000000000000000000000000000000000000000000000000000000m776m6timt5itt0tgtiii00
00055555i55t57m555m670i000000000000000000000000000000000000000000000000000000000000000000000000000000000i05776t0mt5t5itt5ttti0i0
0gg505tt5tt57m775m770g00000000000000000000000000000000000000000000000000000000000000000000000000000000000g0576m56mt55m555ttt0g00
00gg5mt5ttt5577677i0g0000000000000000000000000000000000000000000000000000000000000000000000000000000000000g0g776565t56m55tt0t0g0
000gg55t5t555m677i0i000000000000000000000000000000000000000000000000000000000000000000000000000000000000000g0i7765m56m6mtggt0g00
00ig5g55t565m6m770i00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000i0i76mmm66m56gggg000
00gt555t56m67m77000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000i0g7mmm676656gg0000
0005i5ttmt67m770000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000g7mm7676it000000
000iittmt66677m00000000000000000000000000700000007000000000000000000000g00000000000000000000000000000000000000000t7m776ititg0000
07gittttm6667750000000000000000000000000000000000000000000000000000000g0g0000000000000000000000000000000000000000077676iitg0g00g
7770itt655677500000000000000000000000000000000000000000000070i0g070t000g0g0g070g000000000000000000000000000000000007767tmgtgiig0
77700665m5m7g0000000000000000000000000000000000000000000000000g0g00000000000g0000000000000000000000000000000000000007767mmtiii0g
t75m6tgm7m7i0g000000000000000000000000000000000000000000000g070g070g0007000000000700000000000000000000000000000000007m7m6mmtiigi
i5m55gt7m750i000000000000000000000000000000000000000000000000000i0000000i00000000000000000000000000000000000000000005776mmmmigi0
ii55m5m6770i00000000000000000000000000000000000000000g0g0g07070i0i07070g070g07000g00000000000000000000000000000000000i766mmmgi0i
ii5m5m6m775000000000000000000000000000000000000000000000g0g0007070707070707070700000000000000000000000000000000000000077mmmtigi0
i6i5m6m67m0000000000000000000000000000000000070707070707070707070000070g0g0g0g070g00000000000000000000000000000000000006m6mimi5i
gg6mm7m7i0000000000000000000000000000000000070707070707070000000000000000000g070000000000000000000000000000000000000000m7m6t76mm
iggm6m7i0i0000000000000000000000000000000007070707000g00000g0g0000000000000007070g0007070000000000000000000000000000000g76t7676g
tii6m670i000000000000000000000000000000070g070g00000000000000000000000000000g07000000000000000000000000000000000000000g05757g676
i5mt677g000000000000000000000000000000070g070700000000000707000000000000070g0g0707000007000000000000000000000000000000000m7g7g6m
5itmt7g00000000000000000000000000000000000g070000000000000000000000000000000g070000000000000000000000000000000000000000000t6gt5t
itt757000000000000000000000000000000000707070700000000000007000000070g0g0000000700000007070700000000000000000000000000000t7t65t5
ttt577i00000000000000000000000000000g00000000000000000000000000000000000g0000000000000000000000000000000000000000000000000t7655t
ii577i0000000000000000000000000000070g0g000000000000000000000g00070700000g00000707070007070700000000000000000000000000000007t6t5
iti75000000000000000000000000000000000000000007000000000000000000000000000000000000000000000000000000000000000000000000000t76t6t
tit700000000000000000000000000000007000g0g0007000g00000707070g0707070g0g0707070707070707070i0700000000000000000000000000000i76mt
5757500000000000000000000000000000000000g0g0707000000000000000000000000000000000000000707070700000000000000000000000000000i0t6tm
75760000000000000000000000000000000707070g00070007000g000000070707070707070707070707070707070700000000000000000000000000000i766t
t770t00000000000000000000000000000g00000000070700000000000000000007070707070707070707070707070700000000000000000000000000000m7mm
6t7t000000000000000000000000070g0g0700070i00070i0700000707070707070707070707070707070707000707070000000000000000000000000000076i
t670i00000000000000000000000000000000000000070700070707070707070707070700000000000000000000000700000000000000000000000000000i7ig
g77g000000000000000000000000000707070707070707070707070000000t0000000000000000070700000g000g07070g000000000000000000000000000i7i
g7g00000000000000000000000000070707070000000707000000000000000000000000000000000700000000000007000000000000000000000000000000070
m60000000000000000000000070707070707070g0707070000000000000000000000000000000007070i000g0000070700000000000000000000000000000i7g
t70000000000000000000000000070700000000000007070000000000000000000000000000000007000000000000070000000000000000000000000000000mm
760000000000000000000000000i07070000000007070700000000000000000000000000000000070g070g0g000000070g000g0g000000000000000000000575
m0t00000000000000000000000i0i07000000000000000700000000000000000000000000000000070g000000000007000000000000000000000000000000057
7i0000000000000000000000000i070700070g000700000000000g000000000000000000000000070g0g00000000070700000i0i000000000000000000000i0m
m0i00000000000000000000000000000000000g000000070000000000000000000000000000000007000000000000070000000000000000000000000000000i7
7i00000000000000000000000g0g0g070000070g0g0707000000000000000000000000000000000007070000000g07070g00000000000000000000000000000g
700000000000000000000000g0g000000000000000g00070000000000000000000000000000000007000000000000000000000000000000000000000000000g7
7i00000000000000000000000g0707070g00070g0g0g07070000000000000000000000000i00000007000g0g000000070g000000000000000000000000000i0g
700000000000000000000000000000000000000000g00070000000000000000000000000000000007000000000000000g0g000000000000000000000000000i7
7i0000000000000000000000070707070700000007070i070000000000000000000000000000000007070707070g00070g070000000000000000000000000007
i0i00000000000000000000000000000000000000000i0i0000000000000000000000000000000007000000000000000000000000000000000000000000000i7
7g00000000000000000000070g0g0g070700000007070i0700000000000000000000000000000000070700070000000707070700000000000000000000000007
700000000000000000000000000000007000000000000070000000000000000000000000000000007000000000000000700000000000000000000000000000t7
700000000000000000000g0700000g07000000070g0007070000000000000000000000000000000007070g00000000070g0g0g00000000000000000000000t05
7000000000000000000000000000g0g07000000000000070000000000000000000000000000000007000000000000000700000000000000000000000000000i7
7i0000000000000000000g0000000g0700000000070707070000000000000000000000000000000007070000000g00000g0g0700000000000000000000000007
700000000000000000000000000000007000000000000000000000000000000000000000000000007000000000000000700000000000000000000000000000i7
70000000000000000000000000000007000g0g000707070700000000000000000000000000000000070g0007000000000000070g000000000000000000000007
700000000000000000000000000000007000000000000070000000000000000000000000000000007070g0000000000070000000000000000000000000000007
7000000000000000000000000000000g0g0g00000707070700000000000000000000000000000000070g0707000000000707070g000000000000000000000007
700000000000000000000000000000007000000000000000000000000000000000000000000000000070000000000000700000000000000000000000000000i7
7000000000000000000000000000000i07070g0000000707000000000000000000000000000000000707070700000007070g070g000000000000000000000007
70000000000000000000000000000000700000000000000070000000000000000000000000000000007000000000000070000000000000000000000000000007
7t00000000000000000000000000000000000000000007070000000000000000000000000000000007070g07070g000g070g0000000000000000000000000007
57i00000000000000000000000000000700000000000000070000000000000000000000000000000007000000000000070000000000000000000000000000077
5t00000000000000000000000000000g070g0000000007070000000000000000000000000000000007070g07070g000i070700000i0000000000000000000t7i
t7t000000000000000000000000000007000000000000000700000000000000000000000000000000070g0g0000000007000000000000000000000000000g070
7t0g000000000000000000000000000i0700000007070g0700000000000000000000000000000000070t0g0007070707070000000000000000000000000g0g7i
m7t0000000000000000000000000000070000000000000007000000000000000000000g00070707070707070707070707000000000000000000000000000g77t
7t7t000000000000000000000t000000070g0g000000000000000000070707070707070707070707070t07000707070g0g0000000000000000000000000i07tt
7mt0000000000000000000000000000070700000007070707070707070707070700000g00000g00000700000000000000000000000000000000000000000i7t6
mm7500000000000000000000000000000707070707070707070707070g07070707070707070g0g0707070i0i0707070g0000000000000000000000000000076t
im77500000000000000000000000000000707070g070707070707000g0g00000000000000000g0000070000000000000000000000000000000000000000077m6
5t670g000000000000000000000000000g07070g0g000707070707070g07070g0707000007070g00070707070g070g0700000000000000000000000000057m7m
mmm7g0g000000000000000000000000000000000g00000007000000000000000000000000000000000700000g0g0g0g00000000000000000000000000000mtm6
mmmm7g0000000000000000000000000000000707070007070g00000700000g0g0007070007000000070707070g070g0000000000000000000000000000077mm5
5mmm70g0000000000000000000000000000000000000000070g00000000000000000000000000000007070000000000000000000000000000000000000m7mmmm
m5m5770g00000000000000000000000000000707070007070g00070000070000000g0g07000000000000070707070i0000000000000000000000000000776mm5
5m5657t00000000000000000000000000000700000000000700000000000g00000000000000000000070700000000000000000000000000000000000g076m5mm
i5m5570000000000000000000000000000000g0g00000g07070707070g0g0g0g000g070000000000070707070700000000000000000000000000000g0m7m555m
im5it670000000000000000000000000000000g000000000700000000000g00000000000000000000070700000000000000000000000000000000000g7m7555t
mimtit7t0000000000000000000000000g0g000707070g070707070g0000070g000g07000000070707070707000g000000000000000000000000000g07m6m5tm
tmtit6t7t0000000000000000000000000000000000000007000000000000000000000000000g00070707000000000000000000000000000000000g077mm6igm
tttt6t67000000000000000000000000000000000707000707000g00000g0000070007070707070707070700000t0000000000000000000000000g0g7m5iggmg
5iiti6m670g00000000000000000000000000000000000007000g00000000000707070707070707070700000000000000000000000000000000000g75555tggm
iiii55657t0g0000000000000000000000000000000700000707070707070707070i0700000000000000000000000000000000000000000000000t77755tgtmt
5i657m5t57g00000000000000000000000000000000000000070g0g0g000000000i00000000000000000000000000000000000000000000000000077mm55tmtm
t6t657i5t675000000000000000000000000000000000000070g070g0i000g070i0i0g00000000000g0g000000070000000000000000000000000676m5tg55tg
tt657imi676750000000000000000000000000000000000000g0g00000000000000000000000000000000000000000000000000000000000000067mm6tgtgtgg
m55555i556770i0000000000000000000000000000000000000g070g0g0000070g0000000000000007070700000000000000000000000000000g77m65ttg0tgg
5055555t6767m0i0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000g057767mm5t0t0tg
050t55t5t6757i0g0000000000000000000000000000000000000g000000000707000007000000000g0g000000000000000000000000000g057mm706m0tt0tii
00t0tg5ittt77750000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000i75mmm6600ttttti
gg0t0giiit57577500000000000000000000000000000000000000070000000000000000000000000000000000000000000000000000000i076mm060600t0tgt
0g0gg0igitt57557g00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000777mmm0600000gtg
g0g0g0giiitt5m677500000000000000000000000000000000000000000000000000000000000g0000000000000000000000000000000i067777m6m0m00000gt
000g00iiii5555mm7750g000000000000000000000000000000000000000000000000000000000000000000000000000000000000000i0m76775tt6m50ii000i
00000i0iiit55mmmm77g0g0000000000000000000000000000000000000000000000000000000000000000000000000000000000000i05m6m6mt5tt5miiig000
000g00igit5immmm5777g0g0000000000000000000000000000000000000000000000000000000000000000000000000000000000000776m6m65t5gm5tigtg00
000555gg0iiimtm57m777g0g000000000000000000000000000000000000000000000000000000000000000000000000000000000i077666mti650ggttttg000
005555t0iiit5tt5m77777g00000000000000000000000000000000000000000000000000000000000000000000000000000000000770666ttii0gggtgt00000
0005550t0it0ttit576m77750i0000000000000000000000000000000000000000000000000000000000000000000000000000000t50g0656itgg0gg0t0g0000
000000t00g0t0iti76m6m67750i000000000000000000000000000000000000000000000000000000000000000000000000000075gg00776itgigg0gg0g0g000
000000000gg000i5576m66777t0i0g000000000000000000000000000000000000000000000000000000000000000000000g0g756g0g07titiigiigtg00g0000
00000000000000m5ttt5677767t0g0g0000000000000000000000000000000000000000000000000000000000000000000g0g7765mgtt57titiii5tgt0000000
0000000000g00mmmtit56775m6777g0g00000000000000000000000000000000000000000000000000000000000000000005777665ttt65tmtiiiiit0g000000
0000000gg00i0mmmitit765m577777g0g00000000000000000000000000000000000000000000000000000000000000000776776565t55tmtmmititt00g00000
000000ggg000itmitit56755577m6775050g000000000000000000000000000000000000000000000000000000000g0g7777m5776555tiitmm0mttt0t0000000
0000000g0000ttttit06t605556667677mg0g0000000000000000000000000000000000000000000000000000000g0g777555557665t5ti050m00ttt00000000
000000000000ttti000t6t5m56m6767667750000000000000000000000000000000000000000000000000000000t0i75655555566i656i0i05000g0i00000000
0000000000000t00i00it0m0mm5m6766666770000000000000000000000000000000000000000000000000i0005777555655m5mit666g6i05g0000i0i0000000
000000000000000000i5i00505m5t5m66675i7760i0g00000000000000000000000000000000000000000i0i7777i7555m5t7i5miiig6gmgtti00i0iig000000
0000000000000000i00i0g00555tmm6m6777656777m0i000000000000000000000000000000000000000g0m7766g7im5gtt7t7iiigim0mmtmiti0iii0g000000
00000000000000000000g0g5i5im5mm6m756565677777g000g0i0000000000000000000000000005050777776766g0t0gg5t7iiigim0m0mmttiii000g0000000
0000000000000000000g0ggig005m50mg5t56567t7m77777g0i0i00000000000000000i000t0t0576776566m76m60t0i00t55t0ii05m0mm5m5igi00000000000
00000000000000000000g00i0g0050tt75505gitii7t6i6577777i00000i0i0i0i0i0i0i0t0m7775656t6566mm6mm00g0000t5t00i05005m5igigg0000000000
0000000000000000000000iti0i0it00t0550igiimi6i6665655m777777777g757m7t77777m7tmm65mt6t66565mmm0g0g00g0titi0g0g005i5ig0g0g00000000

