pico-8 cartridge // http://www.pico-8.com
version 29
__lua__

function ff(y)
	local ay
	if (y+t*32)%64<8 then
		ay = 4*sin(t/8)-4
	else
		ay = 0
	end
	return ay
end

function line2(x1,y1,x2,y2,c)
	local num_steps=max(
	 abs(flr(x2)-flr(x1)),
	 abs(flr(y2)-flr(y1)))
	local dx=(x2-x1)/num_steps
	local dy=(y2-y1)/num_steps
	for i=0,num_steps do
	 pset(x1,y1,c)
	 x1+=dx
	 y1+=dy
	end
  end

function fflr(a,unit)
	return a\unit*unit
end

function perp(x,y)
	return -y, x
end

function norm(x,y)
	local d = dist(x,y,0,0)
	return 
		x / d,
		y / d
end

function dist(x1,y1,x2,y2)
	return sqrt((x2-x1)*(x2-x1) + (y2-y1)*(y2-y1))
end

cc={0,5+128,7,5+128}
for i=1,#cc do
	pal(i,cc[i],1)
end

t=0

cls()
::♥::
t+=1/30

pos = -t*16

-- CLEAR THE SCREEN OUT A BIT
for i=1,50 + sin(t/32)*25 do
	local ox=rnd(128+16)-8
	local oy=rnd(128+16)-8
	rectfill(ox,oy,ox+16,oy+16,0)
end

rr=rnd(1)<0.05
rh=rnd(128)-64

-- GENERATE THE LINES
unit=5+sin(t/16)*2
ox=64
lines = {}
for y=pos%unit-1-16,128+unit,unit do
	x = ox + 4*sin(t + y/32)
	y = y + 4*sin(y/32 + t)

	-- IF RR IS TRUE, THEN SHIFT ALL X'S IN THE LINES BY RH
	if rr then
		x=x+rh
	end

	-- MAYBE SHIFT THIS SINGLE X VALUE
	if rnd(1)<0.008 then 
		x=x+rnd(80)-40
	end
	
	x = x + sin(t/16)*16 * sin(t/16 + y/64)

	add(lines, {
		x,y,x+8+ff(x,y),y+8+4*sin(t/4),
		x,y,x-8-ff(x,y),y+8-4*sin(t/8)
	})
end

-- DRAW THE LINES
for key,ln in ipairs(lines) do
	-- ARROW SHAPE: /\
	line2(ln[1],ln[2],ln[3],ln[4],7)
	line2(ln[5],ln[6],ln[7],ln[8],7)

	-- STRAIGHT HORIZONTAL LINES TO THE EDGES
	if rnd(1)<0.02 then
		line2(ln[3],ln[4],128,ln[4],2)
		line2(ln[7],ln[8],0,ln[8],2)
	end

	-- CONNECTING LINES BETWEEN EACH ARROW
	if key~=#lines then 
		ln2 = lines[(key+1)]
		line2(ln[1],ln[2],ln2[1],ln2[2],7)
		line2(ln[3],ln[4],ln2[3],ln2[4],7)
		line2(ln[7],ln[8],ln2[7],ln2[8],7)
	end
end

ang = fflr(t/4,1/8)+rnd(0.01)+sin(t/8)/16
r=1
ax,ay=r*cos(ang), r*sin(ang)
L1=16+sin(t/8)*8
L2=48

pts = {}
for i=L1,L2,(L2-L1)/6 do
	local lx,ly = 64+ax*i, 64+ay*i
	local axn,ayn = norm(ax,ay)
	axn,ayn = perp(axn,ayn)
	axn,ayn = axn*sin(t/16 + lx)*2,ayn*sin(t/8)*2

	add(pts, {lx+axn,ly+ayn})
end

for i=1,#pts-1 do
	local pt1 = pts[i]
	local pt2 = pts[i+1]

	if rnd(1)<0.1 then
		local vx,vy = pt2[1]-pt1[1], pt2[2]-pt1[2]

		local aang = atan2(vx,vy) + rnd(1)
		local rr = dist(vx,vy,0,0)
		if rnd(1)<0.1 then rr=64 aang = atan2(vx,vy) + 1/4 end

		vx,vy = rr*cos(aang), rr*sin(aang)
		pt2 = {pt1[1]+vx, pt1[2]+vx}
	end

	line2(pt1[1],pt1[2],pt2[1],pt2[2],8)
end


-- line(
-- 	64+ax*L1,
-- 	64+ay*L1,
-- 	64+ax*L2,
-- 	64+ay*L2,
-- 	8
-- )


flip() goto ♥
__label__
00000000000000000000000000000000000000000000000000007770070000000007070007770000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000007777700000000070070000077000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000007777700000000070777700000700000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000777700000000777700077000700000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000007070000007777077000770700000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000070000777777007700077llllllllllllllllllllllllllllllllllllllllllllllllll
00000000000000000000000000000000000000000000000000000000007000077770077007707000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000700707700000770770000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000077777770000007000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000007777707700070000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000077770070077070000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000707700070000770000000000000000000000000000000000000000000000000000000
lllllllllllllllllllllllllllllllllllllllllllllllllllllllllll777077777777777700000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000007770077777077777000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000077700070077770007700000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000070700000777777707700000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000707000007777077777700000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000770000007077000777770000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000700000070077000077770000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000070000700007700000770000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000070000700007700000070000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000007007000007770000070000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000007070000007777700070000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000007700000077707777077000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000700000777700077777000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000077700000707700000777000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000007700007007000000077000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000007700070007000000077000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000007700700007700000077000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000070700077777000077000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000077000770007770070000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000070000770000077770000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000070007700000000770000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000070077777000000770000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000077777077770000700000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000007777777000007700700000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000070777700770000077000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000007770777700007700070000000000000000000000000000008800000000000000000000000
00000000000000000000000000000000000000000000000000000077770707077000077700000000000000000000000000000880000000000000000000000000
00000000000000000000000000000000000000000000000000000077007770000777770000000000000000000000000000088000000000000000000000000000
00000000000000000000000000000000000000000000000000000777077770000700000000000000000000000000000008800000000000000000000000000000
0000000000000000000000000000000000000000000000000000707707700770700000000000000000ll8lllllllllll88000000000000000000000000000000
00000000000000000000000000000000000000000000000000007707777000070000000000000000000008000000000800000000000000000000000000000000
00000000000000000000000000000000000000000000000000077077770000070000000000000000000000800000088000000000000000000000000000000000
00000000000000000000000000000000000000000000000000707707707700070000000000000000000000080000800000000000000000000000000000000000
00000000000000000000000000000000000000000000000007077770700077070000000000000000000000008008000000000000000000000000000000000000
00000000000000000000000000000000000000000000000007777777777000770000000000000000000000000880000000000000000000000000000000000000
00000000000000000000000000000000000000000000000077777777777000070000000000000000000000088800000000000000000000000000000000000000
00000000000000000000000llllll000000000000000000777777777777000007000000000000000000008880000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000777777770077000007000000000000000000088000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000777777770077770000700000000000000000880000000000000000000000000000000000000000000
0000000000000000000000000llll000000000000000000777777000077077700700000000000000088008000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000777777000777007077070000000000008800000800000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000777770007770007000770000000000880000000080000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000777700007777777700007000000008000000000008000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000777000077777707770000700000880000000000000800000000000000000000000000000000000000
00000000000000000000000000000000000000000000000777000777700000077000070008000000000000000080000000000000000000000000000000000000
00000000000000000000000000000000000000000000000077007707700000007700070080000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000077007777000000007777007000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000077777770000000077077770700000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000077777700000000770077077770000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000007777700000007070007000070000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000007077000000070700000700007000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000077700000077700000077000700000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000007770000777000000777770070000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000777007707700007070007770000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000077770777000007777000077000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000007707770000077777770077700000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000777700007777777777700700000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000077700007777777777777700000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000007700077777700777777700000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000770077777777700777llllllllllllllllllllllllllllllllllllllllllllllllllll
00000000000000000000000000000000000000000000000000000000000777777770077777770000000000000000000000000000lll00000000000000000llll
00000000000000000000000000000000000000000000000000000000000077777707700777000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000077777777077007000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000777770770770777000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000777770070007707000000000000000000000000000000000000000000000000000000
llllllllllllllllllllllllllllllllllllllllllllllllllllllllll7777700077000077000000000000000000000000000000000000000000000000000000
00000000000000000000000000000l00000000000000000000000000077777000077000007000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000777770000077770007700000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000707070000777777700700000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000077700000707007777770000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000077000007077770077770000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000070000077007707700770000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000070000070007700077770000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000077000700007700000770000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000077007700007770000770000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000007077000007707700077000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000007770000077770077077000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000007700000077777700777000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000700000707007777077000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000700007007000000007000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000700070007000000007000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000770700070770000070000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000077770700770007700070000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000077777700770000077070000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000077777007700000000770000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000077770077770000000700000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000777777007700000700000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000007777770000077000700000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000077777707700000777000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000777777700077000077000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000007707777070000777700000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000077777777707707700000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000777777700000770000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000777777777007000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000007707777077770000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000077007070000770000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000077077770000070000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000777777707700070000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000007777770777077070000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000077777070070770770000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000077770700077007770000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000770077000007000077000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000700770000000700007000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000777700000007777000700000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000770700000007077700700000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000777000000070707777070000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000770700000707007777777000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000707000007007070770777000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000070000007070707077007700000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000077000070707070007700070000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000007000700700000000770007000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000707007000000000777700700000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000707070000000007077777770000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000070700000000070707777770000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000077700000000707000700777000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000007700000007070000070007700000000000000000000000000000000000000000000000000000

