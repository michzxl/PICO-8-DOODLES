pico-8 cartridge // http://www.pico-8.com
version 29
__lua__
#include palettes.lua

c=cos
s=sin

function xset(x,y,c)
	circ(x,y,1,c)
end

function fflr(a,unit)
	return a - a%unit
end

function frames(sec)
	return sec*30
end

palnum=1
palette=pals[palnum]
for i=1,#palette do
	pal(i,palette[i],1)
end
pol=palette

function pcol()
	cs={}
	k=9
	local e=rnd(k)
	if e>=#pol+1 then
	 return 0
	else 
		return e
	end
end

function xy()
	return rnd(128),rnd(128)
end

-->8
t=0
ti=0
dt=1/30
q2=sqrt(2)
pi=3.1415926
r_unit=8
scr_diag=64*q2
n=5
ang_ofs=0
ang_ofs2=0

pts={}
add(pts,{
	x=8,y=0,v=1,c=pcol()
})

cls()
::⌂::
--cls()
t+=dt
ti+=1

if btnp(5) or btnp(4) then
	pal()
	if btnp(5) then
		palnum=(palnum)%#pals+1
	elseif btnp(4) then
		palnum=(palnum-1-1)%#pals+1
	end
	palette=pals[palnum]
	for i=1,#palette do
		pal(i,palette[i],1)
	end
	pol=palette

	pts={}
end

--radius unit changes continuously 
--during the last 2.5 seconds of each 10 second interval
if ti%frames(10)>frames(7.5) then
	r_unit=8+rnd(5)
	r_unit=flr(r_unit)
end

-- --draw some circles around the screen once every second
-- if ti%frames(1)==0 then
-- 	circfill(rnd(128),rnd(128),rnd(45),#pol/2-1)
-- end

--spawn some new particles somewhere at the center ring.
--roughly 18 particles / second
if rnd(1)<0.8 then
	add(pts,{x=0,y=fflr(rnd(128),r_unit),v=rnd(1)<0.5 and 1 or -1,c=#pol})
end

for pt in all(pts) do
	if pt.x<0 or pt.x>128 or pt.y<0 or pt.y>128 then
		-- if particle is far enough out to be 
		-- guaranteed to be off-screen,-- delete it.
		del(pts,pt)
	elseif pt.y%r_unit==0 then
		--if particle lines up with a ring,
		--just move it around.
		pt.x+=pt.v
		if rnd(1)<0.075 and pget(pt.x,pt.y+r_unit)<#pol/2 then
			--small chance that particle will be pushed outward.
			pt.y+=pt.v
		end
	else
		--if particle lands between rings,
		--move it towards the next outer ring.
		pt.y+=pt.v
	end
end

for pt in all(pts) do
	x,y=pt.x,pt.y
	y=x*cos(t/16)/2+y
	if flr(pt.c)==0 then
		circ(x,y,2,c)
	else
		if rnd(1)<0.5 then
			xset(x,y,pt.c)
		else
			pset(x,y,pt.c)
		end
	end
end

for i=1,250 do
	x,y=xy()
	sum=pget(x,y)
	  +pget(x-1,y)
	  +pget(x+1,y)
	  +pget(x,y-1)
	  +pget(x,y+1)
	  +pget(x-1,y-1)
	  +pget(x-1,y+1)
	  +pget(x+1,y-1)
	  +pget(x+1,y+1)
	avg=sum/9
	xset(x,y,avg)
end

for i=1,10 do
	x,y=xy()
	xset(x,y,0)
end

if ti<frames(5) then
	rectfill(0,128-8,128,128,0)
	print("change color scheme with ❎",1,128-7,7)
end


flip() goto ⌂
__gfx__
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__label__
07h00000000000000000000000000000000000000000000000010107317100000000000000000000000000000000000000000000000000000000000000000000
000hh0000000000000000000000000000000000000000000010017b3731000000000000000000000000000000000000000000000000000000000000000000000
00hh0000000000000000000000000000000000000000000h10177b77h00000000000000000000000000000000000000000000000000000000000000000000000
hhh00h0000000j0000000000000000000000000000001hjhh17r710h0h0000000000000000000000000000000000000000000000000000000000000000000000
hhhhh0h0000hjqjhh000000000000000000000000000jj7jj7r01000h00000000000000000000000000000000000000000000000000000000000000000000000
h1h1h1300010qj3j0h0000000000000000000000h01jhjj371000000000000000000000000000000000000000000000000000000000000000000000000000000
1h1j1113rb0r03j3h000000000000000000000hh0131j01010100000000000000000000000000000000000000000000000000000000000000000000000000000
11jj111rbrb0r3333000h0010077701j00010hjhh31j770101000000000000000000000000000000000000000000000000000000000000000000000000000000
131h01jjrbjj3133j10h0h1r1b777rj000001177b777a77000000000000000000000000000000000000000000000000000000000000000000000000000000000
31h1hrj13jjjjh7j1j1rh1r1r7b777r000bb17777j7a7a7b000000h0070000000000000000000000000000000000000000000000000000000000000000000000
1j1h10101jjj77q7jrrqrb7qbbh077731j7b7j7777jja7b7b0000h0h707000000000000000000000000000000000000000000000000000000000000000000000
1jj1hh01r777a77qrqrrqqqbqb0h773137b777jb10q7qq7b7j0000h7770000000000000000000000000000000000000000000000000000000000000000000000
11r0h3h3777a7aqqqrqqq7qqbq7hr7737777b7r1rr3qq7q7j0000730000000000000000000000000000000000000000000000000000000000000000000000000
1rrr0737rq7rarqaqqqaqqjbq7rrbr7777777rjr7rr30q7q7070737300000h000000000000100000000000000000000000000000000000000000000000000000
0r777a7bqbqbrrrbaqaqr3j13rrrrb7qa7h10jj0r730h0q7770777300000h0h00000000011j10000000000000000000000000000000000000000000000000000
j777a7a7nqbrrrbbbqqr3r3313rrb7qaq3101j7jhh0h00177b77000000000h70770000010j1jh000000000000000000000000000000000000000000000000000
hjbq7bjbqbqbb17bj31qr3jj3777hbrqr1h10hj00h00010jb7bhr1j0000r07077770003010j7a000000000000000000000000000000000000000000000000000
jhqbb7bj7qb31r1771010j1bbb7hh3jrjh10h000000000jhjb3rrr0j00r7r7r7777003737r7a7000000000000000000000000000000000000000000000000000
h3bqbbj17030r771701011jbbb071j3j300000000000000j3373rrj0007rq70r07003137r0r77000000000000000000000000000000000000000000000000000
000bbh1377077r171100h11jb7r11111j0000000000103r33331r700770qjq0h000113770r777770000000000000000000000000000000000000000000000000
00jbnb3j77n777111j1hhhh101j1111j1j000000001j1rrr37b11ha7777jqjh0h73017j00h777h00000000000000000000000000000000000000000000000000
0jjjb77q7n7n7r1rjjjhhhhh131h1001jjj3310100j1jrr77b7bhanq770hjh0h73r30000h0h7h000000000000000000000000000000000000000000000000000
jjjjq7qbq7n7rrrrjjjjhhh0h1h100000hh313131rjj3q7h77b7rnqnq010j1h7br3r00000h000h00000000000000000000000000000000000000000000000000
3jjq7qbqb33arrrrrjjrjh0hhhhh0000hhhh31313jrjh7h731br7bnq11011j1071r0000000000000000000000000000000000000000000000000000000000000
hbrjq7bb33r37rrrb7qjjh10hhh000000hh37333h0j77h73jbrbr7bj1017j1j31000000000000000000000000000000000000000000000000000000000000000
0hhjhjb33r3rrrb7rb7j31jhhhh00000000733r3b77a70703jbr13j13h7r7jh10000000000000000000000000000000000000000000000000000000000000000
h00h003133r7n77r7rb3jj13hh0h00000h00073bhba7a777001131j3r3r7rh0h0000000000000000000000000000000000000000000000000000000000000000
00000010j1jn7n77r03r3r3737h0000000hb707hbr3ab77h00011j1r3r10h0h00000000000000000000000000000000000000000000000000000000000000000
000000hj3j7bn7r30703r3b37b00h0000hh7qbb733r37bh000000100r1000h000000000r00000000000000000000000000000000000000000000000000000000
hj000hj33rr7br7r11j33bbqb7b03j3rr3rqbqbb7330b1100000000000000000000000r7r7000000000000000000000000000000000000000000000000000000
jh0701r3r3r7r7r7rj110rqbqbb333j37rqbqbb7h00h000000000000000000000000007r77r00000000000000000000000000000000000000000000000000000
hj707rb33r0rjr7r311110rqabq3r3rr7rr73b7b000000000000000000000000000007777r7r0000000000000000000000000000000000000000000000000000
j1rrb13b3030r71br3111hjraqbb3r3rrbr373bh000jh00000000000000000000000707007r00000000000000000000000000000000000000000000000000000
1jjj11h30003h1brbr310jrqnab7b3r7br103j0jh0jhj000000h100j000000000777070000000000000000000000000000000000000000000000000000000000
jjjjjh1h000hjq7br3j0b0qaqq7br0107q11jjjh0h7j700000h1h1jhj0000h007777000000000000000000000000000000000000000000000000000000000000
jjjjh0h00000h7q7r7rb0aaqaqbrr10101013j70h03rr000010hbbbj7001hj170110000000000000000000000000000000000000000000000000000000000000
hjjj11h0000003337jbqbqaaqqqrrr7jj0r3331j03rrrr00h031bbb7771011j11110000000000000000000000000000000000000000000000000000000000000
jhj3j1hh00003330j1jbqa731h77r7j3jr7r3171007rrh1h00031b1j330baj1h0110000000000000000000000000000000000000000000000000000000000000
hj3j31hhh11013010j11j13137717j1j77r71010007777h1h00101jj373abah0h000000000000000000000000000000000000000000000000000000000000000
11n3nr311h313100111j7j13rh7711jj771001100h7777700h0010hjj33ba00h0000000000000000000000000000000000000000000000000000000000000000
7jrjr3j1j13r1jh00h01jj7r7rh111j7j1010111h1h7770000000h1hj3j300000000000000000000000000000000000000000000000000000000000000000000
jjj1j33j1jr3rhj0000rjr37r0rr100j001011131hj0jh00000000h00j3000000000000000000000000000000000000000000000000000000000000000000000
0j1j1jjhhjrr7bb3j001r3j31jrbrj0h00j3111r370j000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00h113h31rqrbb3j3j111j31jr3rb0h0hj3j31331000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00h1j1rr3qrbqbb3jb31j1j113r3rrrhjjjhh31111000000000000hh001000000000000000077700000000000000000000000000000000000000000000000000
0h1h1jrrb7bqb7aabr101j1j1h3rbrqrjjhhhh010000000000000hhhh10100000000000000777770000000000000000000000000000000000000000000000000
11h13rrbrbrb7aaar0r13jj1jhhbqbrjjj0h000000000h00000000hh3r10000000000h00070777j0000000000000000000000000000000000000000000000000
h111r3rjbrrr37aa0r03j3jj1jh7b7bjjj0000000h0003h000000hrrr3r300000000h0h07770777j000000000000000000000000000000000000000000000000
h01h3rj1jjr333r770r73j11j10qjb7bj000000hh0h0303h00h0h0hrrr3h000000000h7700007770000000000000000000000000000000000000000000000000
0h00000j11h33rbrqq7r71h1100jqjb700h000h0rh0703770000000hrbr1h000000rq7q700000700000000000000000000000000000000000000000000000000
h000000hhhhhhhrqq7q70j1h00hhjj77hh0h000r7r700777000h000hra77100010r7rq7h00000000000000000000000000000000000000000000000000000000
0h000hhhhhhhhh17qq7hj0j000hhhjj01hh077b7r70j7777000000h1hrar7r01017r700000000000000000000000000000000000000000000000000000000000
h0hjhhhhhhhhh1h17hj77j00000hjj070b03777bh010j070h000000h1a77r3h71707000000000000000000000000000000000000000000000000000000000000
1hj3jhhh1h1hhhh1hjhj77h000hhjjq0b7303770hj000707h00000000h7730307000000000000000000000000000000000000000000000000000000000000000
h13j3hhhh1h1hhhh1hjh7h7hjh33hq7q7b03373h0h00007h0h000000001r03770000000000000000000000000000000000000000000000000000000000000000
37r3jr1h1j1j1hhhh1j077h73r3b37q3q0j3j7b0h1000000h000000001j1r7h00000000000000000000000000000000000000000000000000000000000000000
737jjjj1jrj1j1h111j7077b3r03bb3q331j7771100000000000000h001j0h0h0000000000000000000000000000000000000000000000000000000000000000
3jbj1jjjrb10111j133r7r03b070bj13h13h7773h0000000000000h0h0h000h00000000000000000000000000000000000000000000000000000000000000000
j0j1j01j3r010h103j33r0r0q707j1j100h1h7j10h0000000000000h770h00000000000000000000000000000000000000000000000000000000000000000000
0j010101r3r0h0h103br370q7b1jhj100000hjh0h000000000000007777000000000000000000000000000000000000000000000000000000000000000000000
7r1h10177773jh0hjbbbj13h3hh1jh0000000h000000000000007770770000000000000000000000000000000000000000000000000000000000000000000000
r7r1jh77773j7jh0hh1b11131hhh100000000000000000000007rh7h000000000000000000000000000000000000000000000000000000000000000000000000
hr733jh77h11j10hhhhh11hhhhh11h00000h0h00000000007j7r7rh0000000000000000000000000000000000000000000000000000000000000000000000000
j7j333hhhh1j1000hhh00hhhh111110hhhh0hhh007000011j7j1r000000000000000000000000000000000000000000000000000000000000000000000000000
h17131h1hhh1hh00000000hh111j1jhhhhhhjh177070j1111j101000000000000000000000000000000000000000000000000000000000000000000000000000
11h1111hhhhhh000000000h1h1j3jbbbhhh3177177jj0j110h010h00007070000000000000000000000000000000000000000000000000000000000000000000
1h1h111hhhhh0000000h00hh1h1jrrbbbb3777771j7rjh00h000h0h0770700000000000000000000000000000000000000000000000000000000000000000000
00h1hj11hhhh000000h0hh1hh1hrrbbbb3b7q77na7rrrr0000307h077r7000000000000000000000000000000000000000000000000000000000000000000000
010h11731hhjh00j0h0h313hhh1bbbb77b3qbqna7a7rr371r3730777r7r000000000000000000000000000000000000000000000000000000000000000000000
101777373jjhjbjjj0rj137hh133bbq7777bqbrjr77b3r1r1r3777770r0000000000000000000000000000000000000000000000000000000000000000000000
h777777rrjjj0jjj0rj3j03b101r7q777j33brjrjrb7b001rr7r0700000000000000000000000000000000000000000000000000000000000000000000000000
r7777rrrrrj0r010j0rj0b0b71r1rrj7jb331jhjrb7b0j0777rj7000000000000000000000000000000000000000000000000000000000000000000000000000
7r7rrrrrj7rr0131jj3jb0bqbr7rrrrjb7b3hhhh01bjj70770j0j000000000000000000000000000000000000000000000000000000000000000000000000000
r7r3rrrj3j33j31j1j1rabqbqbr1rrrq7bhj00000777j77777hj0000000000000000000000000000000000000000000000000000000000000000000000000000
7j3r3j31jh1j7j31j70a7abqbbb73r10hhhh0000077770770h0h0000000000000000000000000000000000000000000000000000000000000000000000000000
j7h31h1111j7j7b770n0abrb7b7b11010hh0000000h000h0j0h0h000000000000000000000000000000000000000000000000000000000000000000000000000
37hh3177777j7b7b7b0nrbb1hhb13110000000000h0h0h1h0j0h0h00000000000000000000000000000000000000000000000000000000000000000000000000
33h3h377773j37brb3bjjj1hh1hh1h0000000000001001h1j7q7h100000000000000000000000000000000000000000000000000000000000000000000000000
1r7h37777jjr0jrbrbj1jjh1hhhhh000000000000131j017jq7r1r1j000000000070000000000000000000000000000000000000000000000000000000000000
r1r7r3r33jjj333r311j1hhhhhhh1h000000000hj3130h010jrrr1jrj00000000707000000000000000000000000000000000000000000000000000000000000
1rj33r3333j333311111h00hh0h1hhh00000001jjj37hhh0jbjr7rrjb01000077070000000000000000000000000000000000000000000000000000000000000
3311331j3b333310111h00000h0hhh110100011jjjjhhhh1rjb7r77b711107707000000000000000000000000000000000000000000000000000000000000000
011111j1j3rqbqb10hh0h00000hhh1111010j111jjh1hh30770rjraqb111j0770000000000000000000000000000000000000000000000000000000000000000
h011h1hj3j3aq7q1hhhhjj000hhh1111r1b71jj100j713030j7jr1qaq71j77000000000000000000000000000000000000000000000000000000000000000000
0h0j0h1hj3bbaqbjhhh11jj0h1hjh113qb3b7j3j307j173h10j1101q707000000000000000000000000000000000000000000000000000000000000000000000
00jbjhhh7bbbbbbb0h11jj1h1h1h111j33b303j373j1h1h1h1700101010000000000000000000000000000000000000000000000000000000000000000000000
37bjb7731jbb3bb0h0h131j1h1h001h1j13077373j7h1h0h17070011100000000000000000000000000000000000000000000000000000000000000000000000
7r7bq7313113jab70hh37j1jjhh000jh1r1r0j7hj0j0h0000h770010000000000000000000000000000000000000000000000000000000000000000000000000
r7rqbq1h1hh1a7a7j77hj3jj3hhh0hh001r0jhj0hj00000000070000000000000000000000000000000000000000000000000000000000000000000000000000
1r1bq7h1h0hjra777777hj3rjjh1h1h000r7hjh00000000000070000000000000000000000000000000000000000000000000000000000000000000000000000
1111070h0hjr77a7777h03r3rj1h1h0h010h0h000000000000777000000000000000000000000000000000000000000000000000000000000000000000000000
0hhhj70303077a7a1h00h1rrj11hhhh0h000h0000000000000777000000000000000000000000000000000000000000000000000000000000000000000000000
h0hhh730303h770hbh0h1h1r31h1h0hh000000000000000000777000000000000000000000000000000000000000000000000000000000000000000000000000
000h77b773hjj0j0h000h1r1r00h000h000000000000000000070000000000000000000000000000000000000000000000000000000000000000000000000000
00r77b7b70hhhj07h01jh11r10000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
077r77b0000h00777jj1jh7110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
01r100000000h03770jj07hhhh000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0h1000h0h00h03j37j777h3jh0h00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000h0h0hh0hj3jqbq7h3j1jh000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000h0hb737hj1bqb3j73jj10h0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000h0b7b737q3jbrr7qrjrjhjh010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
h000b7h7jb737q0jjjqj77rrj333j101h00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0hjb7b7jjj33b0j0jj01j11r3333331r3h0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
h3b7b7hjhj3b310jh0h011hjb333r7r3r10000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
333bhhhh0hj3b01hj10h10jhj7brbrbr11h000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3333hhh0h0h0000j1j11j10j7rbbrbr71h0h00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
033b1hh100000707j17j1bh0r70b1h7771h070000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
j0bb111hrrq77073j73rb7bh0001h1777h770bh00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
07a311br7r7q77j1737qrbb10h00117777hjb7b00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
7bna7b1qr7q73j1jb73rqb1bh1hh000730j03b700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
jnb77aq7qaqr33jh717777b11h1000h3730303000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1jnaa7rq7qrqr3h0071777ja711h0h0h300137000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
j1rjarjra7qr3a000001q7a7a7h000h0001017700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1111jjrj7a73rj00001q7q7a77700000000177700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
111111j1173r3710003jq7b737000100070007000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
01111111hjr371710hj3j003b70h1117737000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0001jj11j0jrh770hhhj000b7bh07777373000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00h0h1110h0h07070hhh000rb7077777730000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000h1hh0hh0070jhh000r7r77b7700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000hhhhhhhh00000hhhh000j77b7b0000000000000000h0h00000000000hh0h000000000h010000000000000h00000000000000010h000000000000000000000
000hhhj00000000h0hh000j1j70b00000001hhh00100h0h000000h0h00hhhh0000h0000hhhh0000000h0000h0000001000000h00110h00000000000000000000
00hhhjhj00h11q10hhh00h1j100000000011hhhh00110hh0000001hq00qhhjh001q1h0hhhhh000000hhh0h00h00001hh0000h1h11j10h0000000000000000000
0hh1h1jh01111111hhh00qb1h000000000111hh0011qhhhh00001q11001h1hjj1j1h0hhhhhh000000h13h00h00000hj1h0001h1jj1jh00000000000000000000
hhhh1hq0h0q11h11hh0h0b7b0h0000000h111h1h03011hh0000001h10hh1jhh0h0qhhhhh3h100000h1110hh000000j3j00000hjqrq3100000000000000000000
0h0hh11h0hjhhqhh00hqh7b7h00000h0hq1111h111hq000000000h1h0h0hhhhhhhhh0hh3h101h00hhh1jh0q100000qjq0000h0hjq31310000000000000000000
0000h1h1hhhjhh0h0h00hr7r0000000h0j111q111h0h0000000000h000h00hhhhhhhh00hh01h0h0hhhjhhh1qh0000q0q00000h01rq3100000000000000000000
0000hh1hhhhh00h0h00h0hr00000000000j0010h00h000000000000000000000hh00000h0h00h000h00hhhhh0h000000000000001h0h00000000000000000000
0000h0h00hh000000h00h000000000000000000000000000000000000000000000000000h00000000000hh00h00000000000000000h000000000000000000000

