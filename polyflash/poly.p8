pico-8 cartridge // http://www.pico-8.com
version 18
__lua__
█=200
d⧗=0.0333
⧗=0

rmax=30
n=5
pen=32/n
_c=cos(0.5/n)
rmin=rmax*_c

ta=0.008
td=0.98
tv=0
t=0
sw=true

--n-gon
function shape(ang)
	a=rmax*cos(0.5/n)
	b=cos(tri_wave(n*ang-0.5-t/2)/n)
	return a/b
end

--triangle wave, w/ period 1
function tri_wave(x)
	return abs((x+.5)%1-.5)
end

function stats()
	print(flr(100*stat(1)).."%★"
  .."\n"..aba
		,0,0,7)
end

function input()
 if btnp(4) then sw=not sw cls() end
 if btn(0) then tv+=ta end
 if btn(1) then tv-=ta end

 tv*=td
 t=t+tv

 if btnp(2) or btnp(3) then
  rmin=rmax*cos(0.5/n)
  cls()
  if btnp(2) then n+=1 end
  if btnp(3) then n-=1 end
  pen=n
  n=mid(3,n,12)
 end
end

function close(a,b,thresh)
 return abs(a-b)<thresh
end

-->8
cls()
::⌂::
rectfill(0,0,50,10,0)
⧗+=d⧗
input()

aba=flr(█+2800*abs(tv))
for i=1,aba do
 -- pick points inside
 -- the circumscribed circle.
 if not sw then
	 ang,r=rnd(1),rnd(rmax+pen)
 end

 -- pick points inside
 -- the circumscribed circle, and
 -- outside the inscribed circle:
 rmin=rmax*cos(0.5/n)
 if sw then
  ang,r=rnd(1),rnd(rmax+pen-rmin)+rmin
 end

 -- pick any point on screen
 -- ang,r=rnd(1),rnd(91)

	x,y=cos(ang)*r,sin(ang)*r
	
	sr=shape(ang)
	if r<sr then
		c=sw and 0 or ⧗%9+7
	--elseif close(sr,r,pen) then
 elseif r/sr<1.25 then
		c=sw and ⧗%9+7 or 0
	else
  c=0
 end

	circ(x+64,y+64,1,c)
end

stats()

flip() goto ⌂
__gfx__
00000000000700000000000000000000770777077777777700000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000007770000000000000777700000000007777777700000000077770000700000000000000000000000000000000000000000000000000000000000000
00700700070707000000000007777770707770777000777700000000700007770000070000000000000000000000000000000000000000000000000000000000
00077000000700000000770007777770000000000700077000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000000700000000000007777770770777077770000700000700000000000000000000000000000000000000000000000000000000000000000000000000
00700700000700000077000007777770000000007777777700700700000777700070000000000000000000000000000000000000000000000000000000000000
00000000000700000000000000777700707770777777777700000000777000070000007000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000007777777700000000000000000000000000000000000000000000000000000000000000000000000000000000
00777000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
07777700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
77707700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
77077700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077070000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077070000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00707070000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00707000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
