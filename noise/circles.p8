pico-8 cartridge // http://www.pico-8.com
version 29
__lua__

function qsort(a,c,l,r)
	c,l,r=c or function(a,b) return a<b end,l or 1,r or #a
	if l<r then
		if c(a[r],a[l]) then
			a[l],a[r]=a[r],a[l]
		end
		local lp,k,rp,p,q=l+1,l+1,r-1,a[l],a[r]
		while k<=rp do
			local swaplp=c(a[k],p)
			-- "if a or b then else"
			-- saves a token versus
			-- "if not (a or b) then"
			if swaplp or c(a[k],q) then
			else
				while c(q,a[rp]) and k<rp do
					rp-=1
				end
				a[k],a[rp],swaplp=a[rp],a[k],c(a[rp],p)
				rp-=1
			end
			if swaplp then
				a[k],a[lp]=a[lp],a[k]
				lp+=1
			end
			k+=1
		end
		lp-=1
		rp+=1
		-- sometimes lp==rp, so 
		-- these two lines *must*
		-- occur in sequence;
		-- don't combine them to
		-- save a token!
		a[l],a[lp]=a[lp],a[l]
		a[r],a[rp]=a[rp],a[r]
		qsort(a,c,l,lp-1       )
		qsort(a,c,  lp+1,rp-1  )
		qsort(a,c,       rp+1,r)
	end
end

function line2(x1,y1,x2,y2,c)
 local num_steps=max(
  abs(flr(x2)-flr(x1)),
  abs(flr(y2)-flr(y1)))
 local dx=(x2-x1)/num_steps
 local dy=(y2-y1)/num_steps
 for i=0,num_steps do
  pset(x1,y1,c)
  x1+=dx
  y1+=dy
 end
end

pal(1,7,1)

cls()

cs={}
for i=1,6 do
	r=rnd(16)+16
	c={x=rnd(128-r*2)+r,y=rnd(128-r*2)+r,
	   r=r,
	   xv=rnd(2)-1,yv=rnd(2)-1}
	add(cs,c)
end

function upd(c)
	c.x+=c.xv
	c.y+=c.yv
	if c.x-c.r<0 or c.x+c.r>127 then
		c.xv*=-1
	end
	if c.y-c.r<0 or c.y+c.r>127 then
		c.yv*=-1
	end
end
t=-1/30

::♥::
cls()

t+=1/30

foreach(cs,upd)

local skip = 1
for h=0,127,skip do
	local ps = {}
	for c in all(cs) do
		local r = c.r
		local d = abs(h - c.y)
		if d==r then
			add(ps, c.x)
		elseif d>r then
		else
			local a = sqrt(r*r - d*d)
			add(ps,(c.x+a))
			add(ps,(c.x-a))
		end
	end

	qsort(ps)

	local x = 0
	local color = 0
	if #ps>0 then
		if ps[1]<0 then
			x = ps[1]-1
		end

		for x2 in all(ps) do
			rectfill(x\skip*skip,h,x2\skip*skip,h+skip-1,color)
			color = (color+1)%2
			x = x2
		end

		rectfill(x\skip*skip,h,128\skip*skip,h+skip-1,color)
	end
end

flip() goto ♥
__label__
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000600000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000066000000760000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000006000000000006000606000060766000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000676060000006676000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000077766000776767600000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000060600777676777777677770000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000676000676067777767777777777777700000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000006006760607667677777777777777777777707000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000006060000676066767777777777777777777777776060000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000600000767767677767777777777777777777777606000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000070000767776777676677777777777777777777770770000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000076777777766766777777777777777777777700000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000077667706077667677777777777777777777077000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000070777606060600776077767677777777777777777700000000000000000
00000000000000000000000000000000000000000000000000000000000000000000677777060606000060600070767777777777777777070000000000000000
00000000000000000000000000000000000000000000000000000000000000000007667777006670700060000000076777777777777777700000000000000000
00000000000000000000000000000000000000000000000000000000000000000070777770007600000006000000007777777777777777770000000000000000
00000000000000000000000000000000000000000000000000000000000000007007777700006000000060000000006776777777777777777000000000000000
00000000000000000000000000000000000000000000000000000000000000070777777000000000000000000000000067777777777777777000000000000000
00000000000000000000000000000000000000000000000000000000000000007077777000000000000000000000000000777777777777777000000000000000
00000000000000000000000000000000000000000000000000000000000000000777070000000000000000000000000000077777777777770700000000000000
00000000000000000000000000000000000000000000000000000000000000007677700000000000000000000000000000077777777777777000000000000000
00000000000000000000000000000000000000000000000000000000000000006777700000000000000000000000000000077777777777707000000000000000
00000000000000000000000000000000000000000000000000000000000000707777770000000000000000000000000000007777777777770700000000000000
00000000000000000000000000000000000000000000000000000000000007077777707000000000000000000000000000007777777777777000000000000000
00000000000000000000000000000000000000000000000000000000000000777777770000000000000000000000000000000777777777777770000000000000
00000000000000000000000000000000000000000000000000000000000007077777760000000000000000000000000000000077777777777777000000000000
00000000000000000000000000000000000000000000000000000000000007777777670000000000000000000000000000000077777777777776000000000000
00000000000000000000000000000000000000000000000000000000000077777777760000000000000000000000000000000077777777770760000000000000
00000000000000000000000000000000000000000000000000000000000007777777700000000000000000000000000000000007007777770000000000000000
00000000000000000000000000000000000000000000000000000000000707077777000000000000000000000000000000000000767777700700000000000000
00000000000000000000000000000000000000000000000000000000007070707777060000000000000000000000000000000007777777777770000000000000
00000000000000000000000000000000000000000000000000000000000707777777600000000000000000000000000000000000777777777770000000000000
00000000000000000000000000000000000000000000000000000000000077777777760000000000000000000000000000000007777777777707000000000000
00000000000000000000000000000000000000000000000000000000000077777777770000000000000000000000000000000076777777077070000000000000
00000000000000000000000000000000000000000000000000000000000707777777700000000000000000000000000000000007777770777767000000000000
00000000000000000000000000000000000000000000000000000000000077777777777000000000000000000000000000000000777777777776000000000000
00000000000000000000000000000000000000000000000000000000000077777777777070000000000000000000000000000007777777777770000000000000
00000000000000000000000000000000000000000000000000000000000707077777777707000007000000000000000000000067777777070700000000000000
00000000000000000000000000000000000000000000000000000000000070777777777776770770700000000000000000000607767777007000000000000000
00000000000000000000000000000000000000000000000000000000000007707777777707777777700000000000000000060077777677760000000000000000
00000000000000000000000000000000000000000000000000000000000070777776767000777777777000000006000000000767777777700000000000000000
00000000000000000000000000000000000000000000000000000000000007777767606000677777700700000067000000007077777777600000000000000000
00000000000000000000000000000000000000000000000000000000000007777760007000077777770700000000000000000777777777000000000000000000
00000000000000000000000000000000000000000000000000000000000000777600000000607777777777770000060600007777707770700000000000000000
00000000000000000000000000000000000000000000000000000000000007777700000000060767777777777000006000777777070007000000000000000000
00000000000000000000000000000000000000000000000000000000000000777600000000000676077777770000000707677777700000000000000000000000
00000000000000000000000000000000000000000000000000000000000007776760000000006060007777777007000006767777700000000000000000000000
00000000000000000000000000000000000000000000000000000000000007777676000000000000076776777777000067076067600000000000000000000000
00000000000000000000000000000000000000000000000000000000070077777770600000000000660007077770606700707006000000000000000000000000
00000000000000000000000000000000000000000000000000000000606077777777000000000000000000707777677776070000000000000000000000000000
00000000000000000000000000000000000000000000000000000066060607777777777000000000000000066767767700700000000000000000000000000000
00000000000000000000000000000000000000000000000000000600606677777777777700070000000000777677770000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000006767777777777770707000000007077777706006000000006000000000000000000000
00000000000000000000000000000000000000000000000000000000067677777777777777777070000700707770060660000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000676767777777777777770707007777077770006700000000000000000000000000000000
00000000000000000000000000000000000000000000000000000066607677777777777777777770777770777770067006000000000000000000000000000000
00000000000000000000000000000000000000000000000000000006060777777777777777777777777777067700600000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000006607077777777777777777707777777677000060000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000060660607777777777777777777777777777700000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000006676067777777777777777777777777776700000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000060000067676777777777777777777777777777000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000767777777777777777777777777777000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000006077777777777777777777777777770700000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000060677677777777777777777777777777000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000600066767777777777777777777777770000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000067676777777777777777777777777000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000070767677777777777777777777770000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000006076067777777777777777767700000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000677667677777777777777676000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000060000006677676767777777777067660000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000006000000007767676607677770006000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000600000000000677666060766770000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000006066700606670000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000600000670000007600000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000070000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000

